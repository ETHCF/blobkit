<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlobKit Browser Example</title>
</head>
<body>
    <h1>BlobKit Browser Example</h1>
    <p>This example demonstrates how to use BlobKit in a browser environment.</p>
    
    <button id="connectWallet">Connect Wallet</button>
    <button id="writeBlob" disabled>Write Blob</button>
    
    <div id="status"></div>
    <div id="result"></div>

    <script type="module">
        // This would be your bundled BlobKit in a real application
        // For this example, we're showing the usage pattern
        
        // Import BlobKit (after bundling with webpack/rollup/etc)
        // import { BlobKit, initialize } from 'blobkit';
        
        const status = document.getElementById('status');
        const result = document.getElementById('result');
        const connectBtn = document.getElementById('connectWallet');
        const writeBtn = document.getElementById('writeBlob');
        
        let blobkit = null;
        let signer = null;
        
        // Configuration
        const config = {
            rpcUrl: 'https://mainnet.infura.io/v3/YOUR_API_KEY',
            chainId: 1
        };
        
        // Initialize BlobKit for browser
        async function initializeBlobKit() {
            try {
                status.textContent = 'Initializing BlobKit...';
                
                // Automatic initialization with official Ethereum trusted setup
                await initialize();
                
                // Or for development/testing:
                // await initializeForDevelopment();
                
                status.textContent = 'BlobKit initialized successfully!';
            } catch (error) {
                status.textContent = `Initialization failed: ${error.message}`;
                console.error('Initialization error:', error);
            }
        }
        
        // Connect wallet (MetaMask example)
        connectBtn.addEventListener('click', async () => {
            try {
                if (typeof window.ethereum === 'undefined') {
                    throw new Error('MetaMask not installed');
                }
                
                status.textContent = 'Connecting wallet...';
                
                // Request accounts
                const accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });
                
                // Create ethers provider and signer
                const { ethers } = await import('ethers');
                const provider = new ethers.BrowserProvider(window.ethereum);
                signer = await provider.getSigner();
                
                // Create BlobKit instance with signer
                blobkit = new BlobKit(config, signer);
                
                status.textContent = `Connected: ${accounts[0]}`;
                writeBtn.disabled = false;
            } catch (error) {
                status.textContent = `Connection failed: ${error.message}`;
                console.error('Connection error:', error);
            }
        });
        
        // Write blob
        writeBtn.addEventListener('click', async () => {
            try {
                if (!blobkit) {
                    throw new Error('BlobKit not initialized');
                }
                
                status.textContent = 'Writing blob...';
                
                // Example data
                const data = 'Hello from the browser!';
                
                // Write blob
                const receipt = await blobkit.writeBlob(data);
                
                result.innerHTML = `
                    <h3>Blob Written Successfully!</h3>
                    <p><strong>Transaction Hash:</strong> ${receipt.transactionHash}</p>
                    <p><strong>Block Number:</strong> ${receipt.blockNumber}</p>
                    <p><strong>Versioned Hashes:</strong></p>
                    <ul>
                        ${receipt.versionedHashes.map(hash => `<li>${hash}</li>`).join('')}
                    </ul>
                `;
                
                status.textContent = 'Blob written successfully!';
            } catch (error) {
                status.textContent = `Write failed: ${error.message}`;
                console.error('Write error:', error);
            }
        });
        
        // Initialize on page load
        window.addEventListener('load', initializeBlobKit);
    </script>
</body>
</html>